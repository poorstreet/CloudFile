<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>文件列表</title>
<!-- 如果需要使用jQuery,把它的引用放在最开头，避免使用未定义jQuery函数产生Undefined错误 -->
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/fileslist.js"></script>
<style type="text/css">
ul{
	list-style-type:none;
}
</style>
</head>
<body>
	<div id="filesList">
		<div id="files">
			<ul id="list">
				<li id="listHead">文件列表</li>

			</ul>

		</div>
	</div>
	<script type="text/javascript">
		//获取文件列表
		var files;
		//用ajax的“同步方式”调用一般处理程序
		$.ajax({
			url : "ListFiles",
			async : false,//改为同步方式
			type : "Post",
			data : {},
			success : function(date) {
				files = JSON.parse(date);
			}
		});
		//JSON.stringify(files)
		for(var k in files){
			
			var url1="FileRequestManager?file="+k;
			var url2= "FileDownload?file="+k;
			var type = files[k].toLowerCase();
			
			if(type == "mp4"||type == "mp3"){
				//添加play动作
				url1=url1+"&action=play";
			}else if(type == "avi" || type =="wmv"||type == "mkv" || type == "flv"){
				//添加transcoding动作
				url1=url1+"&action=transcoding";
			}else if(type == "pdf" ||type == "txt"){
				//添加read动作
				url1=url1+"&action=read";
			}else{
				url1='';
			}
			if(url1!=''){
				$("<li class = 'list'>" + k + "<a class='request' href="+url1+" target='_blank'>查看</a><a class='request'  href="+url2+" target='_blank'>下载</a></li>").appendTo($("#list"));
			}else{
				$("<li class = 'list'>" + k + "<a class='request' href="+url2+" target='_blank'>下载</a></li>").appendTo($("#list"));
			}
		}
	</script>
</body>
</html>